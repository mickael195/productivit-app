<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#0f1419">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="ProductivitÃ©">
  <meta name="description" content="Application de gestion de productivitÃ© pour atelier automobile">
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">
  
  <!-- IcÃ´nes Apple -->
  <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'%3E%3Crect width='192' height='192' fill='%230f1419'/%3E%3Ctext x='96' y='145' font-size='130' text-anchor='middle' fill='%23ff6b35'%3Eâš¡%3C/text%3E%3C/svg%3E">
  
  <title>âš¡ ProductivitÃ© Atelier</title>
  
  <!-- Google Fonts - Style industriel -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;700;900&family=Barlow:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
/* =============================================
   âš¡ PRODUCTIVITÃ‰ ATELIER - STYLE ORANGE 2026
   Fusion ProductivitÃ© + Convertisseur
   ============================================= */

:root {
  /* Palette industrielle orange */
  --bg-dark: #0f1419;
  --bg-panel: #1a1f28;
  --bg-input: #242b36;
  --text-primary: #e8eaed;
  --text-secondary: #9ca3af;
  --accent-orange: #ff6b35;
  --accent-glow: rgba(255, 107, 53, 0.4);
  --steel-gray: #4a5568;
  --success-green: #10b981;
  --error-red: #ef4444;
  --border-subtle: rgba(255, 255, 255, 0.1);
  
  --radius: 20px;
  --radius-sm: 12px;
  --touch-min: 48px;
  --header-h: 64px;
  --bottombar-h: 76px;
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { font-size: 16px; -webkit-text-size-adjust: 100%; -webkit-tap-highlight-color: transparent; }

body {
  font-family: 'Barlow', -apple-system, BlinkMacSystemFont, sans-serif;
  font-weight: 500;
  background: linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-panel) 100%);
  color: var(--text-primary);
  min-height: 100dvh;
  overflow-x: hidden;
  padding-top: calc(var(--header-h) + var(--safe-top));
  padding-bottom: calc(var(--bottombar-h) + var(--safe-bottom) + 16px);
  position: relative;
}

/* Effet de grille industrielle */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-image: 
    linear-gradient(rgba(255, 107, 53, 0.03) 1px, transparent 1px),
    linear-gradient(90deg, rgba(255, 107, 53, 0.03) 1px, transparent 1px);
  background-size: 50px 50px;
  pointer-events: none;
  z-index: 0;
}

/* â”€â”€ ANIMATIONS â”€â”€ */
@keyframes fadeInUp { from{opacity:0;transform:translateY(20px)} to{opacity:1;transform:translateY(0)} }
@keyframes countUp { from{transform:scale(1.3);opacity:.5} to{transform:scale(1);opacity:1} }
@keyframes toastIn { from{transform:translateY(100px) scale(.8);opacity:0} to{transform:translateY(0) scale(1);opacity:1} }
@keyframes toastOut { from{transform:translateY(0);opacity:1} to{transform:translateY(100px);opacity:0} }
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:.4} }
@keyframes pulseOrange { 0%,100%{box-shadow:0 0 0 0 var(--accent-glow)} 50%{box-shadow:0 0 16px 4px var(--accent-glow)} }
@keyframes pulseGreen { 0%,100%{box-shadow:0 0 0 0 rgba(16,185,129,.4)} 50%{box-shadow:0 0 12px 4px rgba(16,185,129,.15)} }
@keyframes slideInLeft { from{opacity:0;transform:translateX(-20px)} to{opacity:1;transform:translateX(0)} }
@keyframes slideOutRight { to{opacity:0;transform:translateX(30px)} }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• HEADER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#app-header {
  position: fixed; top: 0; left: 0; right: 0; z-index: 100;
  height: calc(var(--header-h) + var(--safe-top)); padding-top: var(--safe-top);
  display: flex; align-items: center; justify-content: space-between;
  padding-left: 20px; padding-right: 16px;
  background: var(--bg-panel);
  backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--border-subtle);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
}

/* Bande orange en haut */
#app-header::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 4px;
  background: linear-gradient(90deg, var(--accent-orange), #ffa500);
  box-shadow: 0 0 20px var(--accent-glow);
}

.header-left { display: flex; align-items: center; gap: 10px; }
.header-icon { font-size: 24px; filter: drop-shadow(0 0 8px var(--accent-glow)); }
#app-header h1 {
  font-family: 'Orbitron', sans-serif;
  font-size: 18px; font-weight: 900; letter-spacing: 2px;
  background: linear-gradient(135deg, var(--text-primary), var(--accent-orange));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
  text-transform: uppercase;
}
.header-actions { display: flex; gap: 8px; }
.header-btn {
  width: 44px; height: 44px; border: none; border-radius: var(--radius-sm);
  background: var(--bg-input); cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  font-size: 20px; transition: all .2s; border: 1px solid var(--border-subtle);
}
.header-btn:active { transform: scale(.92); background: var(--steel-gray); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• STATS GLOBALES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#stats-globales { 
  display: flex; gap: 8px; padding: 16px 16px 8px; 
  overflow-x: auto; scrollbar-width: none; 
}
#stats-globales::-webkit-scrollbar { display: none; }
.stat-chip {
  flex: 1; min-width: 0; 
  background: var(--bg-panel); 
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-sm); 
  padding: 10px 8px; 
  text-align: center;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}
.stat-chip.stat-bilan {
  border: 2px solid var(--accent-orange);
  background: rgba(255, 107, 53, 0.08);
}
.stat-chip.stat-bilan.bilan-positif {
  border-color: var(--success-green);
  background: rgba(16, 185, 129, 0.1);
}
.stat-chip.stat-bilan.bilan-negatif {
  border-color: var(--error-red);
  background: rgba(239, 68, 68, 0.1);
}
.stat-label { 
  display: block; 
  font-size: 10px; 
  font-weight: 600; 
  text-transform: uppercase; 
  letter-spacing: 1px; 
  color: var(--text-secondary); 
  margin-bottom: 3px; 
}
.stat-value { 
  display: block; 
  font-size: 18px; 
  font-weight: 900; 
  color: var(--accent-orange); 
  font-family: 'Orbitron', sans-serif;
}
.stat-bilan-value.bilan-positif {
  color: var(--success-green);
}
.stat-bilan-value.bilan-negatif {
  color: var(--error-red);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• COMPTEURS GLOBAUX â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#global-counters { display: flex; gap: 8px; padding: 4px 16px 8px; }
.counter-chip {
  flex: 1; display: flex; align-items: center; gap: 10px;
  background: var(--bg-panel); border: 1px solid var(--border-subtle);
  border-radius: var(--radius-sm); padding: 10px 12px; transition: all .3s;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}
.counter-chip.active-inac { 
  border-color: var(--accent-orange); 
  background: rgba(255, 107, 53, 0.08); 
}
.counter-chip.active-pression { 
  border-color: var(--success-green); 
  background: rgba(16, 185, 129, 0.08); 
}
.counter-icon { font-size: 22px; }
.counter-info { flex: 1; min-width: 0; }
.counter-title { 
  font-size: 11px; 
  font-weight: 700; 
  text-transform: uppercase; 
  letter-spacing: .5px; 
  color: var(--text-secondary); 
}
.counter-time { 
  font-size: 20px; 
  font-weight: 900; 
  font-variant-numeric: tabular-nums; 
  font-family: 'Orbitron', sans-serif;
}
.counter-time.inac-color { color: var(--accent-orange); }
.counter-time.pression-color { color: var(--success-green); }
.counter-time.blink { animation: blink 1s ease-in-out infinite; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CAROUSEL VÃ‰HICULES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#vehicules-container { padding: 8px 0; flex: 1; }
.carousel { display: flex; flex-direction: column; gap: 14px; padding: 8px 16px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CARTE VÃ‰HICULE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.vehicle-card {
  background: var(--bg-panel); 
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius); 
  overflow: hidden;
  animation: fadeInUp .4s ease backwards;
  transition: box-shadow .3s;
  box-shadow: 
    0 4px 20px rgba(0, 0, 0, 0.3),
    inset 0 1px 0 rgba(255, 255, 255, 0.05);
  position: relative;
}

/* Bande orange dÃ©corative */
.vehicle-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 4px;
  background: linear-gradient(90deg, var(--accent-orange), #ffa500);
  box-shadow: 0 0 20px var(--accent-glow);
}

/* Timer actif â†’ animation verte */
.vehicle-card.timer-active {
  border-color: rgba(16,185,129,.3);
  animation: pulseGreen 2.5s ease-in-out infinite;
}

/* â”€â”€ Partie haute : info (cliquable pour Ã©diter) â”€â”€ */
.vehicle-top {
  display: flex; align-items: stretch; cursor: pointer;
  transition: background .2s; min-height: 90px;
  margin-top: 4px; /* Pour la bande orange */
}
.vehicle-top:active { background: rgba(248,250,252,.03); }

.vehicle-status-badge {
  width: 90px; min-width: 90px; 
  display: flex; flex-direction: column;
  align-items: center; justify-content: center; gap: 4px;
  position: relative; overflow: hidden;
}
.vehicle-status-badge::before { 
  content:''; 
  position: absolute; 
  inset: 0; 
  opacity: .15; 
}
.vehicle-status-badge.status-vert::before { background: var(--success-green); }
.vehicle-status-badge.status-rouge::before { background: var(--error-red); }
.vehicle-status-badge.status-neutre::before { background: var(--accent-orange); }

.status-diff { 
  font-size: 16px; 
  font-weight: 900; 
  line-height: 1.1; 
  text-align: center;
  font-family: 'Orbitron', sans-serif;
}
.status-vert .status-diff { color: var(--success-green); }
.status-rouge .status-diff { color: var(--error-red); }
.status-neutre .status-diff { color: var(--accent-orange); }
.status-icon { font-size: 13px; }

.vehicle-content {
  flex: 1; 
  padding: 12px 14px; 
  display: flex; 
  flex-direction: column;
  justify-content: center; 
  gap: 5px; 
  min-width: 0;
}
.vehicle-name { 
  font-size: 16px; 
  font-weight: 700; 
  white-space: nowrap; 
  overflow: hidden; 
  text-overflow: ellipsis; 
  font-family: 'Orbitron', sans-serif;
}
.vehicle-detail { 
  font-size: 12px; 
  color: var(--text-secondary); 
  display: flex; 
  flex-wrap: wrap; 
  gap: 5px; 
}
.vehicle-detail span { white-space: nowrap; }

/* â”€â”€ Timer et boutons â”€â”€ */
.vehicle-bottom {
  background: var(--bg-input);
  padding: 10px 14px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  border-top: 1px solid var(--border-subtle);
}

.vehicle-timer-row {
  display: flex;
  align-items: center;
  gap: 12px;
}

/* Badge d'Ã©tat (EN COURS / PAUSE / TERMINÃ‰) */
.vehicle-status-label {
  padding: 6px 12px;
  border-radius: 8px;
  font-size: 11px;
  font-weight: 900;
  text-transform: uppercase;
  letter-spacing: 1px;
  font-family: 'Orbitron', sans-serif;
  white-space: nowrap;
  border: 2px solid;
  text-align: center;
  flex-shrink: 0;
}
.vehicle-status-label.status-running {
  background: rgba(16, 185, 129, 0.15);
  border-color: var(--success-green);
  color: var(--success-green);
}
.vehicle-status-label.status-paused {
  background: rgba(255, 107, 53, 0.15);
  border-color: var(--accent-orange);
  color: var(--accent-orange);
}
.vehicle-status-label.status-stopped {
  background: rgba(239, 68, 68, 0.15);
  border-color: var(--error-red);
  color: var(--error-red);
}

.timer-display {
  flex: 1;
  font-family: 'Orbitron', sans-serif;
  font-size: 26px;
  font-weight: 900;
  color: var(--text-primary);
  font-variant-numeric: tabular-nums;
  letter-spacing: 1px;
}
.timer-display.running { color: var(--success-green); }
.timer-display.stopped { color: var(--error-red); }

.timer-btn {
  width: 44px;
  height: 44px;
  border: 2px solid var(--border-subtle);
  border-radius: 50%;
  background: var(--bg-panel);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  transition: all .2s;
  flex-shrink: 0;
}
.timer-btn:active { transform: scale(.92); }
.timer-btn.play { 
  border-color: var(--success-green); 
  color: var(--success-green); 
}
.timer-btn.pause { 
  border-color: var(--accent-orange); 
  color: var(--accent-orange); 
}
.timer-btn.stop { 
  border-color: var(--error-red); 
  color: var(--error-red); 
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• BOTTOM BAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#bottom-bar {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: calc(var(--bottombar-h) + var(--safe-bottom));
  padding-bottom: var(--safe-bottom);
  background: var(--bg-panel);
  border-top: 1px solid var(--border-subtle);
  display: flex;
  align-items: center;
  justify-content: space-around;
  padding: 12px 20px;
  z-index: 99;
  box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
}

.bottom-btn {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
  background: none;
  border: none;
  cursor: pointer;
  padding: 8px;
  transition: all .2s;
  min-width: 64px;
}
.bottom-btn:active { transform: scale(.92); }

.bottom-btn-icon {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  background: var(--bg-input);
  border: 2px solid var(--border-subtle);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  transition: all .2s;
}
.bottom-btn.active .bottom-btn-icon {
  border-color: var(--accent-orange);
  background: rgba(255, 107, 53, 0.15);
  animation: pulseOrange 1.5s ease-in-out infinite;
}
.bottom-btn.active.pression .bottom-btn-icon {
  border-color: var(--success-green);
  background: rgba(16, 185, 129, 0.15);
  animation: pulseGreen 1.5s ease-in-out infinite;
}

#btn-bottom-fab {
  position: relative;
}
#btn-bottom-fab .bottom-btn-icon {
  width: 56px;
  height: 56px;
  background: linear-gradient(135deg, var(--accent-orange), #ffa500);
  border: none;
  font-size: 28px;
  box-shadow: 0 4px 16px var(--accent-glow);
  margin-top: -8px;
}
#btn-bottom-fab:active .bottom-btn-icon {
  transform: scale(.88);
}

.bottom-btn-label {
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--text-secondary);
  transition: color .2s;
}
.bottom-btn.active .bottom-btn-label {
  color: var(--accent-orange);
}
.bottom-btn.active.pression .bottom-btn-label {
  color: var(--success-green);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.85);
  backdrop-filter: blur(8px);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  z-index: 200;
  opacity: 0;
  visibility: hidden;
  transition: all .3s;
}
.modal-overlay.active {
  opacity: 1;
  visibility: visible;
}

.modal-content {
  background: var(--bg-panel);
  border-radius: var(--radius);
  width: 100%;
  max-width: 500px;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 
    0 20px 60px rgba(0, 0, 0, 0.5),
    0 0 0 1px var(--border-subtle),
    inset 0 1px 0 rgba(255, 255, 255, 0.05);
  transform: scale(.9);
  transition: transform .3s;
  position: relative;
}
.modal-overlay.active .modal-content {
  transform: scale(1);
}

/* Bande orange en haut du modal */
.modal-content::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 4px;
  background: linear-gradient(90deg, var(--accent-orange), #ffa500);
  box-shadow: 0 0 20px var(--accent-glow);
}

.modal-header {
  padding: 24px 24px 16px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-bottom: 1px solid var(--border-subtle);
  margin-top: 4px; /* Pour la bande orange */
}
.modal-title {
  font-family: 'Orbitron', sans-serif;
  font-size: 22px;
  font-weight: 900;
  color: var(--text-primary);
  text-transform: uppercase;
  letter-spacing: 1px;
}
.modal-close {
  width: 36px;
  height: 36px;
  border: none;
  background: var(--bg-input);
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  color: var(--text-secondary);
  transition: all .2s;
}
.modal-close:hover { background: var(--steel-gray); color: var(--text-primary); }
.modal-close:active { transform: scale(.9); }

.modal-body {
  padding: 24px;
}

/* â”€â”€ Formulaire â”€â”€ */
.form-group {
  margin-bottom: 24px;
}
.form-label {
  display: block;
  font-size: 13px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--text-secondary);
  margin-bottom: 10px;
}
.form-input {
  width: 100%;
  padding: 14px 18px;
  font-family: 'Barlow', sans-serif;
  font-size: 16px;
  font-weight: 600;
  background: var(--bg-input);
  border: 2px solid transparent;
  border-radius: var(--radius-sm);
  color: var(--text-primary);
  outline: none;
  transition: all .3s;
}
.form-input:focus {
  border-color: var(--accent-orange);
  box-shadow: 0 0 0 4px var(--accent-glow);
}
.form-input::placeholder {
  color: var(--steel-gray);
  font-weight: 400;
}

/* â”€â”€ SystÃ¨me d'ajout de temps (comme Convertisseur) â”€â”€ */
.inputs-container {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin-bottom: 15px;
}

.input-line {
  display: flex;
  gap: 10px;
  align-items: center;
  animation: slideInLeft 0.3s ease-out;
}

.line-number {
  background: var(--accent-orange);
  color: white;
  width: 32px;
  height: 32px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 14px;
  flex-shrink: 0;
  box-shadow: 0 2px 8px var(--accent-glow);
  font-family: 'Orbitron', sans-serif;
}

.input-wrapper {
  position: relative;
  flex: 1;
}

.time-input {
  width: 100%;
  padding: 14px 18px;
  font-family: 'Orbitron', sans-serif;
  font-size: 20px;
  font-weight: 600;
  background: var(--bg-input);
  border: 2px solid transparent;
  border-radius: var(--radius-sm);
  color: var(--text-primary);
  outline: none;
  transition: all .3s;
}
.time-input:focus {
  border-color: var(--accent-orange);
  box-shadow: 0 0 0 4px var(--accent-glow);
  transform: translateY(-2px);
}
.time-input::placeholder {
  color: var(--steel-gray);
  font-weight: 400;
}

.btn-remove-line {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  border: 2px solid var(--error-red);
  background: transparent;
  color: var(--error-red);
  font-size: 24px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  transition: all .2s;
  line-height: 1;
}
.btn-remove-line:hover {
  background: rgba(239, 68, 68, 0.1);
}
.btn-remove-line:active {
  transform: scale(.9);
}

.btn-add-line {
  width: 100%;
  padding: 12px;
  background: transparent;
  border: 2px dashed var(--border-subtle);
  border-radius: var(--radius-sm);
  color: var(--text-secondary);
  font-size: 14px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1px;
  cursor: pointer;
  transition: all .2s;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  font-family: 'Barlow', sans-serif;
}
.btn-add-line:hover {
  border-color: var(--accent-orange);
  color: var(--accent-orange);
}
.btn-add-line:active {
  transform: scale(.98);
}

/* Total prÃ©vu */
.total-display {
  background: var(--bg-input);
  border: 2px solid var(--accent-orange);
  border-radius: var(--radius-sm);
  padding: 16px;
  text-align: center;
  box-shadow: 0 0 20px var(--accent-glow);
}
.total-label {
  font-size: 11px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--text-secondary);
  margin-bottom: 6px;
}
.total-value {
  font-family: 'Orbitron', sans-serif;
  font-size: 32px;
  font-weight: 900;
  color: var(--accent-orange);
}

/* â”€â”€ Boutons d'action â”€â”€ */
.modal-actions {
  display: flex;
  gap: 12px;
  padding: 16px 24px 24px;
  border-top: 1px solid var(--border-subtle);
}
.modal-btn {
  flex: 1;
  padding: 14px;
  border: none;
  border-radius: var(--radius-sm);
  font-family: 'Barlow', sans-serif;
  font-size: 15px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1px;
  cursor: pointer;
  transition: all .2s;
}
.modal-btn-primary {
  background: linear-gradient(135deg, var(--accent-orange), #ffa500);
  color: white;
  box-shadow: 0 4px 16px var(--accent-glow);
}
.modal-btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px var(--accent-glow);
}
.modal-btn-primary:active {
  transform: translateY(0);
}
.modal-btn-danger {
  background: transparent;
  color: var(--error-red);
  border: 2px solid var(--error-red);
}
.modal-btn-danger:hover {
  background: rgba(239, 68, 68, 0.1);
}
.modal-btn-danger:active {
  transform: scale(.96);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TOAST â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#toast-container {
  position: fixed;
  bottom: calc(var(--bottombar-h) + var(--safe-bottom) + 20px);
  left: 50%;
  transform: translateX(-50%);
  z-index: 300;
  display: flex;
  flex-direction: column;
  gap: 8px;
  pointer-events: none;
}
.toast {
  background: var(--bg-panel);
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-sm);
  padding: 12px 20px;
  font-size: 14px;
  font-weight: 600;
  color: var(--text-primary);
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
  animation: toastIn .3s ease;
  pointer-events: auto;
}
.toast.toast-out {
  animation: toastOut .3s ease forwards;
}
.toast-success {
  border-left: 4px solid var(--success-green);
}
.toast-error {
  border-left: 4px solid var(--error-red);
}
.toast-info {
  border-left: 4px solid var(--accent-orange);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SCROLLBAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}
::-webkit-scrollbar-track {
  background: var(--bg-input);
}
::-webkit-scrollbar-thumb {
  background: var(--steel-gray);
  border-radius: 4px;
}
::-webkit-scrollbar-thumb:hover {
  background: var(--accent-orange);
}
  </style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• HEADER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<header id="app-header">
  <div class="header-left">
    <div class="header-icon">âš¡</div>
    <h1>ProductivitÃ©</h1>
  </div>
  <div class="header-actions">
    <div style="font-size: 11px; color: var(--text-secondary); margin-right: 12px; text-align: right; line-height: 1.3;">
      <div style="font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Depuis le</div>
      <div id="date-debut" style="font-family: 'Orbitron', sans-serif; color: var(--accent-orange); font-weight: 700;">â€”</div>
    </div>
    <button class="header-btn" id="btn-pdf" aria-label="Exporter">ğŸ“„</button>
    <button class="header-btn" id="btn-vider" aria-label="Vider">ğŸ—‘ï¸</button>
  </div>
</header>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• STATS GLOBALES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="stats-globales">
  <div class="stat-chip">
    <span class="stat-label">VÃ©hicules</span>
    <span class="stat-value" id="stat-vehicules">0</span>
  </div>
  <div class="stat-chip">
    <span class="stat-label">Temps PrÃ©vu</span>
    <span class="stat-value" id="stat-temps-prevu">0.00h</span>
  </div>
  <div class="stat-chip">
    <span class="stat-label">Temps RÃ©el</span>
    <span class="stat-value" id="stat-temps-reel">0.00h</span>
  </div>
  <div class="stat-chip stat-bilan" id="stat-bilan-chip">
    <span class="stat-label">Bilan Total</span>
    <span class="stat-value stat-bilan-value" id="stat-bilan">â€”</span>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• COMPTEURS GLOBAUX â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="global-counters">
  <div class="counter-chip" id="counter-inac">
    <div class="counter-icon">â¸ï¸</div>
    <div class="counter-info">
      <div class="counter-title">InactivitÃ©</div>
      <div class="counter-time inac-color" id="inac-time">00:00:00</div>
    </div>
  </div>
  <div class="counter-chip" id="counter-pression">
    <div class="counter-icon">âš¡</div>
    <div class="counter-info">
      <div class="counter-title">Pression/Niveau</div>
      <div class="counter-time pression-color" id="pression-time">00:00:00</div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CAROUSEL VÃ‰HICULES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="vehicules-container">
  <div class="carousel" id="carousel"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• BOTTOM BAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="bottom-bar">
  <button class="bottom-btn" id="btn-bottom-inac">
    <div class="bottom-btn-icon">â¸ï¸</div>
    <div class="bottom-btn-label">InactivitÃ©</div>
  </button>
  <button class="bottom-btn" id="btn-bottom-fab">
    <div class="bottom-btn-icon">+</div>
    <div class="bottom-btn-label">Nouveau</div>
  </button>
  <button class="bottom-btn pression" id="btn-bottom-pression">
    <div class="bottom-btn-icon">âš¡</div>
    <div class="bottom-btn-label">Pression/Niveau</div>
  </button>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MODAL VÃ‰HICULE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="modal-overlay" aria-hidden="true">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title" id="modal-title">Nouveau VÃ©hicule</h2>
      <button class="modal-close" id="modal-close" aria-label="Fermer">Ã—</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label" for="input-nom">Nom du vÃ©hicule</label>
        <input type="text" id="input-nom" class="form-input" placeholder="Ex: Peugeot 3008" autocomplete="off">
      </div>
      
      <div class="form-group">
        <label class="form-label">Temps atelier (centiÃ¨mes d'heure)</label>
        <div class="inputs-container" id="inputs-container">
          <div class="input-line" data-line="1">
            <span class="line-number">1</span>
            <div class="input-wrapper">
              <input type="text" class="time-input" placeholder="Ex: 0.45" autocomplete="off" inputmode="decimal" data-line="1">
            </div>
          </div>
        </div>
        <button class="btn-add-line" id="btn-add-line">
          + Ajouter une ligne
        </button>
      </div>

      <div class="total-display">
        <div class="total-label">Temps PrÃ©vu Total</div>
        <div class="total-value" id="total-prevu">0.00h</div>
      </div>
    </div>
    <div class="modal-actions">
      <button class="modal-btn modal-btn-danger" id="btn-supprimer" style="display:none;">Supprimer</button>
      <button class="modal-btn modal-btn-primary" id="btn-valider">Valider</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MODAL CONFIRMATION â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="confirm-overlay" aria-hidden="true">
  <div class="modal-content" style="max-width: 400px;">
    <div class="modal-header">
      <h2 class="modal-title">Confirmer ?</h2>
      <button class="modal-close" id="confirm-cancel-x" aria-label="Fermer">Ã—</button>
    </div>
    <div class="modal-body">
      <p style="color: var(--text-secondary); line-height: 1.6;">
        ÃŠtes-vous sÃ»r de vouloir <strong style="color: var(--error-red);">effacer toutes les donnÃ©es</strong> ? Cette action est irrÃ©versible.
      </p>
    </div>
    <div class="modal-actions">
      <button class="modal-btn modal-btn-danger" id="confirm-cancel">Annuler</button>
      <button class="modal-btn modal-btn-primary" id="confirm-ok">Confirmer</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TOAST CONTAINER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="toast-container"></div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   âš¡ PRODUCTIVITÃ‰ ATELIER - LOGIQUE PRINCIPALE
   VERSION AMÃ‰LIORÃ‰E - TIMESTAMPS POUR SURVIVRE Ã€ LA VEILLE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

// â”€â”€â”€â”€â”€â”€â”€ VARIABLES GLOBALES â”€â”€â”€â”€â”€â”€â”€
var vehicules = [];
var vehiculeEditIndex = -1;
var lineCounter = 1;
var MAX_LINES = 15;

// Timers d'affichage uniquement (mise Ã  jour visuelle toutes les secondes)
var displayUpdateInterval = null;

// â”€â”€â”€â”€â”€â”€â”€ UTILITAIRES TIMESTAMP â”€â”€â”€â”€â”€â”€â”€

// Calculer le temps rÃ©el Ã©coulÃ© basÃ© sur les timestamps
function getElapsedSeconds(startTimestamp, accumulatedSeconds) {
  if (!startTimestamp) return accumulatedSeconds || 0;
  var now = Date.now();
  var elapsedSinceStart = Math.floor((now - startTimestamp) / 1000);
  return (accumulatedSeconds || 0) + elapsedSinceStart;
}

// â”€â”€â”€â”€â”€â”€â”€ LOCAL STORAGE â”€â”€â”€â”€â”€â”€â”€
function chargerVehicules() {
  try {
    var data = localStorage.getItem('vehicules_atelier');
    if (!data) return [];
    var vehicules = JSON.parse(data);
    
    // MIGRATION : Convertir ancien format (tempsReelSeconds) vers nouveau (accumulatedSeconds + startTimestamp)
    var needsMigration = false;
    vehicules = vehicules.map(function(v) {
      // Si ancien format dÃ©tectÃ©
      if (v.tempsReelSeconds !== undefined && v.accumulatedSeconds === undefined) {
        needsMigration = true;
        console.log('ğŸ”„ Migration vÃ©hicule:', v.nom);
        return {
          nom: v.nom,
          tempsPrevuCentH: v.tempsPrevuCentH,
          lignesTemps: v.lignesTemps || [v.tempsPrevuCentH],
          accumulatedSeconds: v.tempsReelSeconds || 0,
          startTimestamp: null,
          timerRunning: false,
          timerStopped: v.timerStopped || false,
          dateCreation: v.dateCreation || new Date().toISOString()
        };
      }
      
      // Nouveau format - s'assurer que tous les champs existent
      return {
        nom: v.nom,
        tempsPrevuCentH: v.tempsPrevuCentH,
        lignesTemps: v.lignesTemps || [v.tempsPrevuCentH],
        accumulatedSeconds: v.accumulatedSeconds || 0,
        startTimestamp: v.startTimestamp || null,
        timerRunning: v.timerRunning || false,
        timerStopped: v.timerStopped || false,
        dateCreation: v.dateCreation || new Date().toISOString()
      };
    });
    
    // Sauvegarder le format migrÃ©
    if (needsMigration) {
      console.log('âœ… Migration terminÃ©e - sauvegarde...');
      localStorage.setItem('vehicules_atelier', JSON.stringify(vehicules));
    }
    
    return vehicules;
  } catch(e) { 
    console.error('âŒ Erreur chargement vÃ©hicules:', e);
    return []; 
  }
}

function sauvegarderVehicules(arr) {
  try {
    localStorage.setItem('vehicules_atelier', JSON.stringify(arr));
  } catch(e) {}
}

function chargerGlobales() {
  try {
    var data = localStorage.getItem('globales_atelier');
    if (!data) {
      return { 
        inactiviteSeconds: 0,
        inactiviteStartTimestamp: null,
        pressionSeconds: 0, 
        pressionStartTimestamp: null,
        dateDebut: new Date().toISOString() 
      };
    }
    
    var globales = JSON.parse(data);
    
    // MIGRATION : Ajouter les nouveaux champs timestamp s'ils n'existent pas
    var needsMigration = false;
    if (globales.inactiviteStartTimestamp === undefined) {
      globales.inactiviteStartTimestamp = null;
      needsMigration = true;
    }
    if (globales.pressionStartTimestamp === undefined) {
      globales.pressionStartTimestamp = null;
      needsMigration = true;
    }
    if (!globales.dateDebut) {
      globales.dateDebut = new Date().toISOString();
      needsMigration = true;
    }
    
    // Sauvegarder le format migrÃ©
    if (needsMigration) {
      console.log('ğŸ”„ Migration compteurs globaux');
      localStorage.setItem('globales_atelier', JSON.stringify(globales));
    }
    
    return globales;
  } catch(e) {
    console.error('âŒ Erreur chargement globales:', e);
    return { 
      inactiviteSeconds: 0,
      inactiviteStartTimestamp: null,
      pressionSeconds: 0,
      pressionStartTimestamp: null,
      dateDebut: new Date().toISOString() 
    };
  }
}

function sauvegarderGlobales(obj) {
  try {
    localStorage.setItem('globales_atelier', JSON.stringify(obj));
  } catch(e) {}
}

// â”€â”€â”€â”€â”€â”€â”€ CONVERSION â”€â”€â”€â”€â”€â”€â”€
function centHToSeconds(centH) {
  return Math.round(centH * 3600);
}

function secondesToCentH(sec) {
  return sec / 3600;
}

function formatCentH(centH) {
  return centH.toFixed(2) + 'h';
}

function formatTime(seconds) {
  var h = Math.floor(seconds / 3600);
  var m = Math.floor((seconds % 3600) / 60);
  var s = seconds % 60;
  return String(h).padStart(2, '0') + ':' + String(m).padStart(2, '0') + ':' + String(s).padStart(2, '0');
}

function formatDifference(diffSeconds) {
  var absSeconds = Math.abs(diffSeconds);
  var h = Math.floor(absSeconds / 3600);
  var m = Math.floor((absSeconds % 3600) / 60);
  
  var sign = diffSeconds >= 0 ? '+' : '-';
  
  if (h === 0 && m === 0) {
    return 'â€”';
  }
  
  var parts = [];
  if (h > 0) parts.push(h + 'h');
  if (m > 0) parts.push(m + 'min');
  
  return sign + parts.join(' ');
}

// â”€â”€â”€â”€â”€â”€â”€ CALCUL DIFFÃ‰RENCE â”€â”€â”€â”€â”€â”€â”€
function calculerDifference(v, globales) {
  // Si globales n'est pas fourni, le charger (pour compatibilitÃ©)
  if (!globales) globales = chargerGlobales();
  
  var currentSeconds = v.timerRunning 
    ? getElapsedSeconds(v.startTimestamp, v.accumulatedSeconds)
    : (v.accumulatedSeconds || 0);
    
  if (!currentSeconds || currentSeconds === 0) {
    return { diffSeconds: null, couleur: '#ff6b35', label: 'â€”' };
  }
  
  var prevuSeconds = centHToSeconds(v.tempsPrevuCentH);
  var diffBrut = prevuSeconds - currentSeconds;
  
  var inacSeconds = globales.inactiviteStartTimestamp 
    ? getElapsedSeconds(globales.inactiviteStartTimestamp, globales.inactiviteSeconds)
    : globales.inactiviteSeconds;
  var diffSeconds = diffBrut - inacSeconds;
  
  var couleur = '#ff6b35';
  if (diffSeconds > 0) couleur = '#10b981';
  else if (diffSeconds < 0) couleur = '#ef4444';
  
  var label = formatDifference(diffSeconds);
  
  return { diffSeconds: diffSeconds, couleur: couleur, label: label };
}

// â”€â”€â”€â”€â”€â”€â”€ RENDER â”€â”€â”€â”€â”€â”€â”€
function renderAll() {
  // Charger les globales UNE SEULE FOIS pour Ã©viter plusieurs appels Ã  localStorage
  var globales = chargerGlobales();
  
  renderStats(globales);
  renderVehicules(globales);
  renderCompteurs(globales);
}

function renderStats(globales) {
  var nbVehicules = vehicules.length;
  var totalPrevuCentH = vehicules.reduce(function(sum, v) { return sum + v.tempsPrevuCentH; }, 0);
  
  var totalReelSeconds = vehicules.reduce(function(sum, v) {
    if (v.timerRunning) {
      return sum + getElapsedSeconds(v.startTimestamp, v.accumulatedSeconds);
    }
    return sum + (v.accumulatedSeconds || 0);
  }, 0);
  
  var totalReelCentH = secondesToCentH(totalReelSeconds);
  
  document.getElementById('stat-vehicules').textContent = nbVehicules;
  document.getElementById('stat-temps-prevu').textContent = totalPrevuCentH.toFixed(2);
  document.getElementById('stat-temps-reel').textContent = totalReelCentH.toFixed(2);
  
  var bilanElement = document.getElementById('stat-bilan');
  var bilanChip = document.getElementById('stat-bilan-chip');
  
  if (totalReelSeconds === 0) {
    bilanElement.textContent = 'â€”';
    bilanElement.className = 'stat-value stat-bilan-value';
    bilanChip.classList.remove('bilan-positif', 'bilan-negatif');
  } else {
    var totalPrevuSeconds = centHToSeconds(totalPrevuCentH);
    var diffBrut = totalPrevuSeconds - totalReelSeconds;
    
    var inacSeconds = globales.inactiviteStartTimestamp 
      ? getElapsedSeconds(globales.inactiviteStartTimestamp, globales.inactiviteSeconds)
      : globales.inactiviteSeconds;
    var bilanSeconds = diffBrut - inacSeconds;
    
    var bilanLabel = formatDifference(bilanSeconds);
    bilanElement.textContent = bilanLabel;
    
    bilanElement.className = 'stat-value stat-bilan-value';
    bilanChip.classList.remove('bilan-positif', 'bilan-negatif');
    
    if (bilanSeconds > 0) {
      bilanElement.classList.add('bilan-positif');
      bilanChip.classList.add('bilan-positif');
    } else if (bilanSeconds < 0) {
      bilanElement.classList.add('bilan-negatif');
      bilanChip.classList.add('bilan-negatif');
    }
  }
}

function renderVehicules(globales) {
  var carousel = document.getElementById('carousel');
  
  if (vehicules.length === 0) {
    carousel.innerHTML = '<div style="text-align:center; padding:60px 20px; color:var(--text-secondary);"><p style="font-size:48px; margin-bottom:16px;">ğŸš—</p><p style="font-size:18px; font-weight:600;">La sÃ©curitÃ©, notre prioritÃ©!</p><p style="font-size:14px; margin-top:8px;">Appuyez sur + pour commencer</p></div>';
    return;
  }
  
  var existingCards = carousel.querySelectorAll('.vehicle-card');
  
  // Si le nombre de cartes a changÃ©, reconstruire tout
  if (existingCards.length !== vehicules.length) {
    rebuildAllCards(globales);
    return;
  }
  
  // Sinon, juste mettre Ã  jour les valeurs
  vehicules.forEach(function(v, idx) {
    updateVehicleCard(idx, globales);
  });
}

// Fonction pour reconstruire toutes les cartes (appelÃ©e seulement si ajout/suppression)
function rebuildAllCards(globales) {
  var carousel = document.getElementById('carousel');
  carousel.innerHTML = '';
  
  vehicules.forEach(function(v, idx) {
    var card = document.createElement('div');
    card.className = 'vehicle-card';
    card.setAttribute('data-vehicle-id', idx);
    if (v.timerRunning) card.classList.add('timer-active');
    
    var diff = calculerDifference(v, globales);
    var statusClass = 'status-neutre';
    if (diff.diffSeconds !== null) {
      if (diff.diffSeconds > 0) statusClass = 'status-vert';
      else if (diff.diffSeconds < 0) statusClass = 'status-rouge';
    }
    
    var topDiv = document.createElement('div');
    topDiv.className = 'vehicle-top';
    topDiv.onclick = function() { ouvrirEditer(idx); };
    
    var badge = document.createElement('div');
    badge.className = 'vehicle-status-badge ' + statusClass;
    badge.innerHTML = '<div class="status-diff">' + diff.label + '</div><div class="status-icon">â±ï¸</div>';
    
    var currentSeconds = v.timerRunning 
      ? getElapsedSeconds(v.startTimestamp, v.accumulatedSeconds)
      : (v.accumulatedSeconds || 0);
    
    var content = document.createElement('div');
    content.className = 'vehicle-content';
    
    // CrÃ©er les Ã©lÃ©ments avec textContent pour sÃ©curitÃ©
    var nameDiv = document.createElement('div');
    nameDiv.className = 'vehicle-name';
    nameDiv.textContent = v.nom;
    
    var detailDiv = document.createElement('div');
    detailDiv.className = 'vehicle-detail';
    detailDiv.innerHTML = '<span>PrÃ©vu: ' + v.tempsPrevuCentH.toFixed(2) + '</span><span>â€¢</span><span>RÃ©el: ' + (currentSeconds ? secondesToCentH(currentSeconds).toFixed(2) : 'â€”') + '</span>';
    
    content.appendChild(nameDiv);
    content.appendChild(detailDiv);
    
    topDiv.appendChild(badge);
    topDiv.appendChild(content);
    
    var bottomDiv = document.createElement('div');
    bottomDiv.className = 'vehicle-bottom';
    
    // Badge d'Ã©tat (EN COURS / PAUSE / TERMINÃ‰)
    var statusLabel = document.createElement('div');
    statusLabel.className = 'vehicle-status-label';
    if (v.timerRunning) {
      statusLabel.classList.add('status-running');
      statusLabel.textContent = 'EN COURS';
    } else if (v.timerStopped) {
      statusLabel.classList.add('status-stopped');
      statusLabel.textContent = 'TERMINÃ‰';
    } else {
      statusLabel.classList.add('status-paused');
      statusLabel.textContent = 'PAUSE';
    }
    
    // Row pour timer + boutons
    var timerRow = document.createElement('div');
    timerRow.className = 'vehicle-timer-row';
    
    var timerDisplay = document.createElement('div');
    timerDisplay.className = 'timer-display';
    if (v.timerRunning) timerDisplay.classList.add('running');
    else if (v.timerStopped) timerDisplay.classList.add('stopped');
    timerDisplay.textContent = formatTime(currentSeconds);
    
    var playBtn = document.createElement('button');
    playBtn.className = 'timer-btn play';
    playBtn.innerHTML = v.timerRunning ? 'â¸' : 'â–¶';
    playBtn.onclick = function(e) { e.stopPropagation(); toggleVehicleTimer(idx); };
    
    var stopBtn = document.createElement('button');
    stopBtn.className = 'timer-btn stop';
    stopBtn.innerHTML = 'â¹';
    stopBtn.onclick = function(e) { e.stopPropagation(); stopVehicleTimer(idx); };
    
    timerRow.appendChild(timerDisplay);
    timerRow.appendChild(playBtn);
    timerRow.appendChild(stopBtn);
    
    bottomDiv.appendChild(statusLabel);
    bottomDiv.appendChild(timerRow);
    
    card.appendChild(topDiv);
    card.appendChild(bottomDiv);
    carousel.appendChild(card);
  });
}

// Fonction pour mettre Ã  jour UNE carte sans la recrÃ©er
function updateVehicleCard(idx, globales) {
  var v = vehicules[idx];
  var carousel = document.getElementById('carousel');
  var cards = carousel.querySelectorAll('.vehicle-card');
  var card = cards[idx];
  
  if (!card) return;
  
  // Mettre Ã  jour la classe timer-active
  if (v.timerRunning) {
    card.classList.add('timer-active');
  } else {
    card.classList.remove('timer-active');
  }
  
  // Calculer les valeurs actuelles
  var currentSeconds = v.timerRunning 
    ? getElapsedSeconds(v.startTimestamp, v.accumulatedSeconds)
    : (v.accumulatedSeconds || 0);
  
  var diff = calculerDifference(v, globales);
  
  // Mettre Ã  jour le badge de diffÃ©rence
  var statusBadge = card.querySelector('.vehicle-status-badge');
  if (statusBadge) {
    statusBadge.classList.remove('status-vert', 'status-rouge', 'status-neutre');
    
    var statusClass = 'status-neutre';
    if (diff.diffSeconds !== null) {
      if (diff.diffSeconds > 0) statusClass = 'status-vert';
      else if (diff.diffSeconds < 0) statusClass = 'status-rouge';
    }
    statusBadge.classList.add(statusClass);
    
    var statusDiff = statusBadge.querySelector('.status-diff');
    if (statusDiff) {
      statusDiff.textContent = diff.label;
    }
  }
  
  // Mettre Ã  jour le nom (avec textContent pour sÃ©curitÃ©)
  var nameDiv = card.querySelector('.vehicle-name');
  if (nameDiv) {
    nameDiv.textContent = v.nom;
  }
  
  // Mettre Ã  jour le temps rÃ©el dans le dÃ©tail
  var detail = card.querySelector('.vehicle-detail');
  if (detail) {
    detail.innerHTML = '<span>PrÃ©vu: ' + v.tempsPrevuCentH.toFixed(2) + '</span><span>â€¢</span><span>RÃ©el: ' + (currentSeconds ? secondesToCentH(currentSeconds).toFixed(2) : 'â€”') + '</span>';
  }
  
  // Mettre Ã  jour le timer display
  var timerDisplay = card.querySelector('.timer-display');
  if (timerDisplay) {
    timerDisplay.textContent = formatTime(currentSeconds);
    
    // Mettre Ã  jour les classes
    timerDisplay.classList.remove('running', 'stopped');
    if (v.timerRunning) timerDisplay.classList.add('running');
    else if (v.timerStopped) timerDisplay.classList.add('stopped');
  }
  
  // Mettre Ã  jour le badge d'Ã©tat (EN COURS / PAUSE / TERMINÃ‰)
  var statusLabel = card.querySelector('.vehicle-status-label');
  if (statusLabel) {
    statusLabel.classList.remove('status-running', 'status-paused', 'status-stopped');
    if (v.timerRunning) {
      statusLabel.classList.add('status-running');
      statusLabel.textContent = 'EN COURS';
    } else if (v.timerStopped) {
      statusLabel.classList.add('status-stopped');
      statusLabel.textContent = 'TERMINÃ‰';
    } else {
      statusLabel.classList.add('status-paused');
      statusLabel.textContent = 'PAUSE';
    }
  }
  
  // Mettre Ã  jour le bouton play/pause
  var playBtn = card.querySelector('.timer-btn.play');
  if (playBtn) {
    playBtn.innerHTML = v.timerRunning ? 'â¸' : 'â–¶';
  }
}

function renderCompteurs(globales) {
  var inacSeconds = globales.inactiviteStartTimestamp 
    ? getElapsedSeconds(globales.inactiviteStartTimestamp, globales.inactiviteSeconds)
    : globales.inactiviteSeconds;
  var pressionSeconds = globales.pressionStartTimestamp 
    ? getElapsedSeconds(globales.pressionStartTimestamp, globales.pressionSeconds)
    : globales.pressionSeconds;
  
  document.getElementById('inac-time').textContent = formatTime(inacSeconds);
  document.getElementById('pression-time').textContent = formatTime(pressionSeconds);
  
  if (globales.dateDebut) {
    var dateDebut = new Date(globales.dateDebut);
    var dateStr = dateDebut.getDate() + '/' + (dateDebut.getMonth() + 1);
    document.getElementById('date-debut').textContent = dateStr;
  }
  
  var chipInac = document.getElementById('counter-inac');
  var chipPression = document.getElementById('counter-pression');
  var timeInac = document.getElementById('inac-time');
  var timePression = document.getElementById('pression-time');
  
  var inacRunning = globales.inactiviteStartTimestamp !== null;
  var pressionRunning = globales.pressionStartTimestamp !== null;
  
  if (inacRunning) {
    chipInac.classList.add('active-inac');
    timeInac.classList.add('blink');
    document.getElementById('btn-bottom-inac').classList.add('active');
  } else {
    chipInac.classList.remove('active-inac');
    timeInac.classList.remove('blink');
    document.getElementById('btn-bottom-inac').classList.remove('active');
  }
  
  if (pressionRunning) {
    chipPression.classList.add('active-pression');
    timePression.classList.add('blink');
    document.getElementById('btn-bottom-pression').classList.add('active');
  } else {
    chipPression.classList.remove('active-pression');
    timePression.classList.remove('blink');
    document.getElementById('btn-bottom-pression').classList.remove('active');
  }
}

// â”€â”€â”€â”€â”€â”€â”€ TIMERS VÃ‰HICULE (BASÃ‰S SUR TIMESTAMPS) â”€â”€â”€â”€â”€â”€â”€
function toggleVehicleTimer(idx) {
  var v = vehicules[idx];
  
  if (v.timerRunning) {
    // PAUSE - sauvegarder le temps accumulÃ©
    var elapsed = getElapsedSeconds(v.startTimestamp, v.accumulatedSeconds);
    v.accumulatedSeconds = elapsed;
    v.startTimestamp = null;
    v.timerRunning = false;
  } else {
    // PLAY - dÃ©marrer avec timestamp actuel
    v.startTimestamp = Date.now();
    v.timerRunning = true;
    v.timerStopped = false;
  }
  
  sauvegarderVehicules(vehicules);
  renderAll();
}

function stopVehicleTimer(idx) {
  var v = vehicules[idx];
  
  if (v.timerRunning) {
    var elapsed = getElapsedSeconds(v.startTimestamp, v.accumulatedSeconds);
    v.accumulatedSeconds = elapsed;
    v.startTimestamp = null;
  }
  
  v.timerRunning = false;
  v.timerStopped = true;
  sauvegarderVehicules(vehicules);
  renderAll();
}

// â”€â”€â”€â”€â”€â”€â”€ COMPTEURS GLOBAUX (BASÃ‰S SUR TIMESTAMPS) â”€â”€â”€â”€â”€â”€â”€

// Fonction pour mettre en pause tous les timers actifs
function pauseAllVehicleTimers() {
  var anyPaused = false;
  vehicules.forEach(function(v, idx) {
    if (v.timerRunning) {
      // Mettre en pause ce vÃ©hicule
      var elapsed = getElapsedSeconds(v.startTimestamp, v.accumulatedSeconds);
      v.accumulatedSeconds = elapsed;
      v.startTimestamp = null;
      v.timerRunning = false;
      anyPaused = true;
    }
  });
  
  if (anyPaused) {
    sauvegarderVehicules(vehicules);
    return true; // Retourne true si au moins un vÃ©hicule a Ã©tÃ© mis en pause
  }
  return false;
}

function toggleInactivite() {
  var g = chargerGlobales();
  
  if (g.inactiviteStartTimestamp) {
    // PAUSE - sauvegarder le temps accumulÃ©
    var elapsed = getElapsedSeconds(g.inactiviteStartTimestamp, g.inactiviteSeconds);
    g.inactiviteSeconds = elapsed;
    g.inactiviteStartTimestamp = null;
  } else {
    // PLAY - dÃ©marrer avec timestamp actuel
    g.inactiviteStartTimestamp = Date.now();
    
    // âœ… NOUVEAU : Mettre en pause tous les vÃ©hicules actifs
    var vehiclesPaused = pauseAllVehicleTimers();
    if (vehiclesPaused) {
      showToast('VÃ©hicules mis en pause', 'info');
    }
  }
  
  sauvegarderGlobales(g);
  
  // Recharger pour avoir l'Ã©tat Ã  jour aprÃ¨s sauvegarde
  g = chargerGlobales();
  
  // Mettre Ã  jour tout l'affichage (y compris les badges des vÃ©hicules)
  renderAll();
}

function togglePression() {
  var g = chargerGlobales();
  
  if (g.pressionStartTimestamp) {
    // PAUSE
    var elapsed = getElapsedSeconds(g.pressionStartTimestamp, g.pressionSeconds);
    g.pressionSeconds = elapsed;
    g.pressionStartTimestamp = null;
  } else {
    // PLAY
    g.pressionStartTimestamp = Date.now();
    
    // âœ… NOUVEAU : Mettre en pause tous les vÃ©hicules actifs
    var vehiclesPaused = pauseAllVehicleTimers();
    if (vehiclesPaused) {
      showToast('VÃ©hicules mis en pause', 'info');
    }
  }
  
  sauvegarderGlobales(g);
  
  // Recharger pour avoir l'Ã©tat Ã  jour aprÃ¨s sauvegarde
  g = chargerGlobales();
  
  // Mettre Ã  jour tout l'affichage (y compris les badges des vÃ©hicules)
  renderAll();
}

function updateAllDifferences(globales) {
  // Appeler updateVehicleCard pour chaque vÃ©hicule avec globales
  vehicules.forEach(function(v, idx) {
    updateVehicleCard(idx, globales);
  });
}

// â”€â”€â”€â”€â”€â”€â”€ BOUCLE DE MISE Ã€ JOUR VISUELLE â”€â”€â”€â”€â”€â”€â”€
function startDisplayUpdates() {
  if (displayUpdateInterval) return;
  
  displayUpdateInterval = setInterval(function() {
    renderAll();
  }, 1000);
}

function stopDisplayUpdates() {
  if (displayUpdateInterval) {
    clearInterval(displayUpdateInterval);
    displayUpdateInterval = null;
  }
}

// â”€â”€â”€â”€â”€â”€â”€ PAGE VISIBILITY API - GÃ‰RER VEILLE/RÃ‰VEIL â”€â”€â”€â”€â”€â”€â”€
document.addEventListener('visibilitychange', function() {
  if (document.hidden) {
    // APP EN VEILLE - pas besoin de mettre Ã  jour l'affichage
    console.log('â¸ï¸ App en veille - timestamps sauvegardÃ©s');
    stopDisplayUpdates();
  } else {
    // APP RÃ‰VEILLÃ‰E - recalculer tout basÃ© sur les timestamps
    console.log('âš¡ App rÃ©veillÃ©e - recalcul des timers');
    
    // Recharger les donnÃ©es depuis localStorage (au cas oÃ¹ modifiÃ©es par un autre onglet)
    vehicules = chargerVehicules();
    
    // VÃ©rifier l'Ã©tat des compteurs globaux aussi
    var g = chargerGlobales();
    console.log('ğŸ“Š Ã‰tat au rÃ©veil - VÃ©hicules:', vehicules.length, '| InactivitÃ© actif:', !!g.inactiviteStartTimestamp, '| Pression actif:', !!g.pressionStartTimestamp);
    
    // RedÃ©marrer la mise Ã  jour visuelle
    startDisplayUpdates();
    
    // Mise Ã  jour immÃ©diate
    renderAll();
  }
});

// â”€â”€â”€â”€â”€â”€â”€ MODAL VÃ‰HICULE â”€â”€â”€â”€â”€â”€â”€
function ouvrirNouveau() {
  vehiculeEditIndex = -1;
  document.getElementById('modal-title').textContent = 'Nouveau VÃ©hicule';
  document.getElementById('btn-supprimer').style.display = 'none';
  document.getElementById('input-nom').value = '';
  
  var container = document.getElementById('inputs-container');
  container.innerHTML = '<div class="input-line" data-line="1"><span class="line-number">1</span><div class="input-wrapper"><input type="text" class="time-input" placeholder="Ex: 0.45" autocomplete="off" inputmode="decimal" data-line="1"></div></div>';
  lineCounter = 1;
  document.getElementById('btn-add-line').style.display = 'flex';
  
  updateTotal();
  ouvrirModal();
}

function ouvrirEditer(idx) {
  vehiculeEditIndex = idx;
  var v = vehicules[idx];
  document.getElementById('modal-title').textContent = 'Modifier VÃ©hicule';
  document.getElementById('btn-supprimer').style.display = 'block';
  document.getElementById('input-nom').value = v.nom;
  
  var container = document.getElementById('inputs-container');
  container.innerHTML = '';
  
  var lignes = v.lignesTemps || [v.tempsPrevuCentH];
  lineCounter = 0;
  
  lignes.forEach(function(centH) {
    lineCounter++;
    var line = document.createElement('div');
    line.className = 'input-line';
    line.dataset.line = lineCounter;
    line.innerHTML = '<span class="line-number">' + lineCounter + '</span><div class="input-wrapper"><input type="text" class="time-input" placeholder="Ex: 0.45" autocomplete="off" inputmode="decimal" data-line="' + lineCounter + '" value="' + centH.toFixed(2) + '"></div>' + (lineCounter > 1 ? '<button class="btn-remove-line" type="button" onclick="removeLine(' + lineCounter + ')">Ã—</button>' : '');
    container.appendChild(line);
  });
  
  if (lineCounter >= MAX_LINES) {
    document.getElementById('btn-add-line').style.display = 'none';
  } else {
    document.getElementById('btn-add-line').style.display = 'flex';
  }
  
  updateTotal();
  ouvrirModal();
}

function updateTotal() {
  var inputs = document.querySelectorAll('.time-input');
  var total = 0;
  
  inputs.forEach(function(input) {
    var val = input.value.trim().replace(',', '.');
    if (val && !isNaN(val)) {
      total += parseFloat(val);
    }
  });
  
  document.getElementById('total-prevu').textContent = total.toFixed(2);
}

function addLine() {
  if (lineCounter >= MAX_LINES) {
    showToast('Maximum ' + MAX_LINES + ' lignes atteint', 'error');
    return;
  }
  
  lineCounter++;
  
  var newLine = document.createElement('div');
  newLine.className = 'input-line';
  newLine.dataset.line = lineCounter;
  newLine.innerHTML = '<span class="line-number">' + lineCounter + '</span><div class="input-wrapper"><input type="text" class="time-input" placeholder="Ex: 0.45" autocomplete="off" inputmode="decimal" data-line="' + lineCounter + '"></div><button class="btn-remove-line" type="button" onclick="removeLine(' + lineCounter + ')">Ã—</button>';
  
  document.getElementById('inputs-container').appendChild(newLine);
  
  var newInput = newLine.querySelector('.time-input');
  newInput.addEventListener('input', updateTotal);
  newInput.focus();
  
  if (lineCounter >= MAX_LINES) {
    document.getElementById('btn-add-line').style.display = 'none';
  }
}

function removeLine(lineNumber) {
  var line = document.querySelector('.input-line[data-line="' + lineNumber + '"]');
  if (line) {
    line.style.animation = 'slideOutRight 0.3s ease-out';
    setTimeout(function() {
      line.remove();
      lineCounter--;
      
      if (lineCounter < MAX_LINES) {
        document.getElementById('btn-add-line').style.display = 'flex';
      }
      
      updateTotal();
      renumberLines();
    }, 300);
  }
}

function renumberLines() {
  var lines = document.querySelectorAll('.input-line');
  lines.forEach(function(line, index) {
    var number = index + 1;
    line.querySelector('.line-number').textContent = number;
  });
}

// â”€â”€â”€â”€â”€â”€â”€ SAUVEGARDE VÃ‰HICULE â”€â”€â”€â”€â”€â”€â”€
function sauvegarderVehicule() {
  var nom = document.getElementById('input-nom').value.trim();
  if (!nom) {
    showToast('Entrez le nom du vÃ©hicule', 'error');
    return;
  }
  
  var inputs = document.querySelectorAll('.time-input');
  var lignesTemps = [];
  var total = 0;
  
  inputs.forEach(function(input) {
    var val = input.value.trim().replace(',', '.');
    if (val && !isNaN(val)) {
      var centH = parseFloat(val);
      
      // VALIDATION : vÃ©rifier que la valeur est valide
      if (centH < 0 || centH > 999 || !isFinite(centH)) {
        showToast('Valeur invalide (min: 0, max: 999)', 'error');
        lignesTemps = []; // Vider pour forcer l'erreur
        return;
      }
      
      lignesTemps.push(centH);
      total += centH;
    }
  });
  
  if (lignesTemps.length === 0 || total === 0) {
    showToast('Ajoutez au moins un temps', 'error');
    return;
  }
  
  if (vehiculeEditIndex >= 0) {
    vehicules[vehiculeEditIndex].nom = nom;
    vehicules[vehiculeEditIndex].tempsPrevuCentH = total;
    vehicules[vehiculeEditIndex].lignesTemps = lignesTemps;
    showToast('"' + nom + '" mis Ã  jour !', 'success');
  } else {
    vehicules.push({
      nom: nom,
      tempsPrevuCentH: total,
      lignesTemps: lignesTemps,
      accumulatedSeconds: 0,
      startTimestamp: null,
      timerRunning: false,
      timerStopped: false,
      dateCreation: new Date().toISOString()
    });
    showToast('"' + nom + '" ajoutÃ© !', 'success');
  }
  
  sauvegarderVehicules(vehicules);
  fermerModal();
  renderAll();
}

function supprimerVehicule() {
  if (vehiculeEditIndex < 0) return;
  var nom = vehicules[vehiculeEditIndex].nom;
  vehicules.splice(vehiculeEditIndex, 1);
  sauvegarderVehicules(vehicules);
  fermerModal();
  renderAll();
  showToast('"' + nom + '" supprimÃ©', 'info');
}

// â”€â”€â”€â”€â”€â”€â”€ MODALS â”€â”€â”€â”€â”€â”€â”€
function ouvrirModal() {
  document.getElementById('modal-overlay').classList.add('active');
  document.getElementById('modal-overlay').setAttribute('aria-hidden', 'false');
  if (vehiculeEditIndex < 0) {
    setTimeout(function() {
      document.getElementById('input-nom').focus();
    }, 400);
  }
}

function fermerModal() {
  document.getElementById('modal-overlay').classList.remove('active');
  document.getElementById('modal-overlay').setAttribute('aria-hidden', 'true');
  renderAll();
}

function ouvrirConfirmVider() {
  document.getElementById('confirm-overlay').classList.add('active');
}

function fermerConfirm() {
  document.getElementById('confirm-overlay').classList.remove('active');
}

function viderTout() {
  vehicules = [];
  sauvegarderVehicules(vehicules);
  sauvegarderGlobales({ 
    inactiviteSeconds: 0,
    inactiviteStartTimestamp: null,
    pressionSeconds: 0,
    pressionStartTimestamp: null,
    dateDebut: new Date().toISOString() 
  });
  fermerConfirm();
  renderAll();
  showToast('DonnÃ©es effacÃ©es !', 'info');
}

// â”€â”€â”€â”€â”€â”€â”€ EXPORT PNG â”€â”€â”€â”€â”€â”€â”€
function exporterPDF() {
  if (vehicules.length === 0) {
    showToast('Aucun vÃ©hicule Ã  exporter', 'error');
    return;
  }
  
  var c = document.createElement('canvas');
  var s = 2, pw = 595 * s, ph = 842 * s;
  c.width = pw;
  c.height = ph;
  var x = c.getContext('2d');
  
  x.fillStyle = '#ffffff';
  x.fillRect(0, 0, pw, ph);
  
  x.fillStyle = '#0f1419';
  x.fillRect(0, 0, pw, 80 * s);
  
  x.fillStyle = '#ff6b35';
  x.font = 'bold ' + (14 * s) + 'px sans-serif';
  x.fillText('âš¡ BILAN PRODUCTIVITÃ‰ ATELIER', 30 * s, 35 * s);
  
  var d = new Date(), g = chargerGlobales();
  x.fillStyle = '#9ca3af';
  x.font = (10 * s) + 'px sans-serif';
  x.fillText(d.toLocaleDateString('fr-FR'), 30 * s, 55 * s);
  
  var inacSeconds = g.inactiviteStartTimestamp 
    ? getElapsedSeconds(g.inactiviteStartTimestamp, g.inactiviteSeconds)
    : g.inactiviteSeconds;
  var pressionSeconds = g.pressionStartTimestamp 
    ? getElapsedSeconds(g.pressionStartTimestamp, g.pressionSeconds)
    : g.pressionSeconds;
  
  x.fillStyle = '#e8eaed';
  x.font = 'bold ' + (11 * s) + 'px sans-serif';
  x.textAlign = 'right';
  x.fillText('InactivitÃ©: ' + formatTime(inacSeconds) + ' | Pression/Niveau: ' + formatTime(pressionSeconds), pw - 30 * s, 35 * s);
  
  var totalPrevuSeconds = centHToSeconds(vehicules.reduce(function(sum, v) { return sum + v.tempsPrevuCentH; }, 0));
  var totalReelSeconds = vehicules.reduce(function(sum, v) {
    if (v.timerRunning) {
      return sum + getElapsedSeconds(v.startTimestamp, v.accumulatedSeconds);
    }
    return sum + (v.accumulatedSeconds || 0);
  }, 0);
  
  var bilanSeconds = totalReelSeconds > 0 ? (totalPrevuSeconds - totalReelSeconds - inacSeconds) : 0;
  var bilanLabel = totalReelSeconds > 0 ? formatDifference(bilanSeconds) : 'â€”';
  var bilanColor = bilanSeconds > 0 ? '#10b981' : (bilanSeconds < 0 ? '#ef4444' : '#ff6b35');
  
  x.fillStyle = bilanColor;
  x.fillText('BILAN: ' + bilanLabel, pw - 30 * s, 55 * s);
  x.fillStyle = '#e8eaed';
  x.fillText(vehicules.length + ' vÃ©hicule(s) | ', pw - 30 * s - x.measureText('BILAN: ' + bilanLabel).width - 10 * s, 55 * s);
  x.textAlign = 'left';
  
  var y = 100 * s;
  var cols = [30, 200, 340, 430].map(function(c) { return c * s; });
  
  x.fillStyle = '#1a1f28';
  x.fillRect(20 * s, y, pw - 40 * s, 28 * s);
  x.fillStyle = '#e8eaed';
  x.font = 'bold ' + (9 * s) + 'px sans-serif';
  ['VÃ‰HICULE', 'PRÃ‰VU', 'RÃ‰EL', 'DIFFÃ‰RENCE'].forEach(function(h, i) {
    x.fillText(h, cols[i], y + 18 * s);
  });
  y += 32 * s;
  
  vehicules.forEach(function(v, idx) {
    x.fillStyle = idx % 2 === 0 ? '#f8fafc' : '#f1f5f9';
    x.fillRect(20 * s, y, pw - 40 * s, 26 * s);
    
    var diff = calculerDifference(v, g);
    x.fillStyle = diff.couleur;
    x.fillRect(20 * s, y, 4 * s, 26 * s);
    
    var currentSeconds = v.timerRunning 
      ? getElapsedSeconds(v.startTimestamp, v.accumulatedSeconds)
      : (v.accumulatedSeconds || 0);
    
    x.font = (9 * s) + 'px sans-serif';
    x.fillStyle = '#1a1f28';
    x.fillText(v.nom.substring(0, 22), cols[0], y + 17 * s);
    x.fillText(v.tempsPrevuCentH.toFixed(2), cols[1], y + 17 * s);
    x.fillText(currentSeconds ? secondesToCentH(currentSeconds).toFixed(2) : 'â€”', cols[2], y + 17 * s);
    
    x.fillStyle = diff.couleur;
    x.font = 'bold ' + (9 * s) + 'px sans-serif';
    x.fillText(diff.label, cols[3], y + 17 * s);
    
    y += 28 * s;
  });
  
  x.fillStyle = '#9ca3af';
  x.font = (8 * s) + 'px sans-serif';
  x.textAlign = 'center';
  x.fillText('GÃ©nÃ©rÃ© par âš¡ ProductivitÃ© Atelier', pw / 2, ph - 30 * s);
  
  c.toBlob(function(blob) {
    var u = URL.createObjectURL(blob), a = document.createElement('a');
    a.href = u;
    a.download = 'bilan-productivite-' + d.getFullYear() + '-' + String(d.getMonth() + 1).padStart(2, '0') + '.png';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(u);
    showToast('Bilan exportÃ© ! ğŸ“„', 'success');
  }, 'image/png');
}

// â”€â”€â”€â”€â”€â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€
function showToast(msg, type) {
  type = type || 'info';
  var container = document.getElementById('toast-container');
  var toast = document.createElement('div');
  toast.className = 'toast toast-' + type;
  toast.textContent = msg;
  container.appendChild(toast);
  setTimeout(function() {
    toast.classList.add('toast-out');
    setTimeout(function() {
      toast.remove();
    }, 300);
  }, 2500);
}

// â”€â”€â”€â”€â”€â”€â”€ EVENTS â”€â”€â”€â”€â”€â”€â”€
document.addEventListener('DOMContentLoaded', function() {
  console.log('âš¡ ProductivitÃ© Atelier - DÃ©marrage');
  
  // Charger les donnÃ©es (avec migration automatique)
  vehicules = chargerVehicules();
  var g = chargerGlobales();
  
  // Message de bienvenue avec info migration
  if (vehicules.length > 0) {
    console.log('ğŸ“Š VÃ©hicules chargÃ©s:', vehicules.length);
  }
  
  renderAll();
  startDisplayUpdates();
  
  document.getElementById('btn-pdf').addEventListener('click', exporterPDF);
  document.getElementById('btn-vider').addEventListener('click', ouvrirConfirmVider);
  
  document.getElementById('btn-bottom-inac').addEventListener('click', toggleInactivite);
  document.getElementById('btn-bottom-fab').addEventListener('click', ouvrirNouveau);
  document.getElementById('btn-bottom-pression').addEventListener('click', togglePression);
  
  document.getElementById('modal-close').addEventListener('click', fermerModal);
  document.getElementById('modal-overlay').addEventListener('click', function(e) {
    if (e.target === e.currentTarget) fermerModal();
  });
  document.getElementById('btn-add-line').addEventListener('click', addLine);
  document.getElementById('btn-valider').addEventListener('click', sauvegarderVehicule);
  document.getElementById('btn-supprimer').addEventListener('click', supprimerVehicule);
  
  document.getElementById('confirm-cancel').addEventListener('click', fermerConfirm);
  document.getElementById('confirm-cancel-x').addEventListener('click', fermerConfirm);
  document.getElementById('confirm-ok').addEventListener('click', viderTout);
  
  document.addEventListener('input', function(e) {
    if (e.target.classList.contains('time-input')) {
      updateTotal();
    }
  });
  
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
      navigator.serviceWorker.register('./sw.js')
        .then(function(registration) {
          console.log('âœ… Service Worker enregistrÃ©');
        })
        .catch(function(error) {
          console.log('âŒ Service Worker erreur:', error);
        });
    });
  }
  
  console.log('âœ… Application prÃªte');
});

window.removeLine = removeLine;
</script>
</body>
</html>

